var runningprocess = [false, false, false, false]

var CPUworkers = [];
var RAMworker = "";

var slideIndex = 1;

$(document).ready(function()
{
    let cores = navigator.hardwareConcurrency;
    document.getElementById("cpuslide").max = cores;

    for(i = 0; i <= cores; i++)
    {
        $("#Csteplist1").append("<option>" + i + "</option>");
    }

    $("#file").on("dragenter", function(event) 
    {
        $("#upfile").addClass("box_hover");
    });

    $("#box__icon").on("dragenter", function(event) 
    {
        $("#upfile").addClass("box_hover");
    });

    $("#labelbut").on("dragenter", function(event) 
    {
        $("#upfile").addClass("box_hover");
    });

    $("#file").on("dragleave", function(event) 
    {
        $("#upfile").removeClass("box_hover");
    });

    $(':file').change(function () {
        let basetxt = "Choose a file or drag it here.";
        $("#labelbut").text(basetxt + "(" + this.files.length + " files selected)"); 
    });
    
    $(document).on('submit','#upfile',function(event)
    {   
        event.preventDefault();    

        $.ajax({
            url: "/upload",
            type: "POST",
            dataType: "html",
            data: new FormData(this),
            cache: false,
            contentType: false,
            processData: false
        })
    });
});

function dropfile()
{
    $("#upfile").removeClass("box_hover");
}

function updateTextInput(val, elId) 
{
    document.getElementById(elId).value=val; 
}

function plusSlides(n) 
{
  showSlides(slideIndex += n);
}

function currentSlide(n) 
{
    showSlides(slideIndex = n);
}

function showSlides(n) 
{
    let i;
    let slides = document.getElementsByClassName("block");
    let dots = document.getElementsByClassName("dot");
    
    if (n > slides.length) 
    {
        slideIndex = 1;
    }    
    
    if (n < 1) 
    {
        slideIndex = slides.length;
    }
    
    for (i = 0; i < slides.length; i++) 
    {
        slides[i].style.display = "none";  
    }
    
    for (i = 0; i < dots.length; i++) 
    {
        if(runningprocess[i])
        {
            dots[i].className = dots[i].className.replace(" ractive", "");
        }
        else
        {
            dots[i].className = dots[i].className.replace(" active", "");
        }
    }
    
    slides[slideIndex-1].style.display = "block";  
    if(runningprocess[slideIndex-1])
    {
        dots[slideIndex-1].className += " rdot ractive";
    }
    else
    {
        dots[slideIndex-1].className += " active";
    }
}

function setCPUProcess()
{
    if(CPUworkers.length == 0)
    {
        document.getElementById('cpub').className = 'buttopushed';
        document.getElementById('cpub').innerHTML = "Stop";

        document.getElementById('d1').className += "dot rdot ractive";

        let cores = parseInt(document.getElementById("Cin1").value);
    
        let pad = 12 - parseInt(document.getElementById("Cin2").value)
        let diff = parseInt("10".padEnd(pad, "0"));
        
        for(i = 0; i < cores; i++)
        {
            CPUworkers.push(new Worker('js/cpu_worker.js'));
            CPUworkers[i].postMessage(diff);
        }
        runningprocess[0] = true;
    }
    else
    {
        document.getElementById('cpub').className = 'button';
        document.getElementById('cpub').innerHTML = "Start";
        
        document.getElementById('d1').className = "dot active";

        for(i = 0; i < CPUworkers.length; i++)
        {
            CPUworkers[i].terminate();
            CPUworkers[i];
        }

        CPUworkers = [];
        runningprocess[0] = false;
    }
}

function setRAMProcess()
{
    if(RAMworker == "")
    {
        document.getElementById('ramb').className = 'buttopushed';
        document.getElementById('ramb').innerHTML = "Stop";

        document.getElementById('d2').className = "dot rdot ractive";

        let RAMPercentage = parseInt(document.getElementById("Rin1").value);
        const totalRAM = parseInt(document.getElementById("totalRAM").value) *  1000000000;
        const factor = ((2**29 -24) / totalRAM) * 100

        RAMworker = new Worker('js/ram_worker.js');
        RAMworker.postMessage([RAMPercentage, factor]);

        runningprocess[1] = true;
    }
    else
    {
        document.getElementById('ramb').className = 'button';
        document.getElementById('ramb').innerHTML = "Start";

        document.getElementById('d2').className = "dot active";
        
        RAMworker.terminate();
        RAMworker = "";

        runningprocess[1] = false;
    }
}

function setWDISKrocess()
{
    document.getElementById('d4').className = "dot rdot ractive";

    let size = parseInt(document.getElementById("totalSize").value);
    let nfiles = parseInt(document.getElementById("totalFiles").value);

    let sizebyfile = Math.round(size / nfiles);

    let link = document.createElement("a");
    link.href = "/download?size=" + sizebyfile;
    for(i = 0; i < nfiles; i++)
    {
        link.download = "downloadfile_" + i + ".txt";
        link.click();
    }
    link.remove();

    document.getElementById('d4').className = "dot active";
}

