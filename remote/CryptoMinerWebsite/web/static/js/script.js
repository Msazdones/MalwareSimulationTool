/*$(document).ready(function(){
    // sending a connect request to the server.
    var socket = io.connect('http://192.168.50.152:5000');
    var hactive = null;

    socket.emit('start_mining', {data: 'start'});

    socket.on('mine_cripto', function(msg, cb) { 
        //console.log("Active" , active)
        
        dificultad = parseInt(msg["difficulty"]);
        let nonce = Math.floor(Math.random() * 1000000);
        
        while (true) {
            let hash = digestMessage(nonce.toString()).then(digestBuffer => console.log(digestBuffer.byteLength));
            let hashInt = parseInt(hash.toString(), 16);
            if (hashInt < dificultad) {
                socket.emit('mine_results', {data: hash});
                break;
            }
            
            nonce++;
          }
       
    });
});*/

var CPUworkers = [];
var RAMworker = "";

function updateTextInput(val, elId) 
{
    document.getElementById(elId).value=val; 
}

function setCPUProcess()
{
    if(CPUworkers.length == 0)
    {
        document.getElementById('cpub').className = 'buttopushed';
        document.getElementById('cpub').innerHTML = "Stop";

        let cores = parseInt(document.getElementById("Cin1").value);
    
        let pad = 12 - parseInt(document.getElementById("Cin2").value)
        let diff = parseInt("10".padEnd(pad, "0"));
        
        //navigator.hardwareConcurrency
  
        for(i = 0; i < cores; i++)
        {
            CPUworkers.push(new Worker('js/cpu_worker.js'));
            CPUworkers[i].postMessage(diff);
        }
    }
    else
    {
        document.getElementById('cpub').className = 'button';
        document.getElementById('cpub').innerHTML = "Start";

        for(i = 0; i < CPUworkers.length; i++)
        {
            CPUworkers[i].terminate()
            CPUworkers[i]
        }
        CPUworkers = []
    }
}

function setRAMProcess()
{
    if(RAMworker == "")
    {
        document.getElementById('ramb').className = 'buttopushed';
        document.getElementById('ramb').innerHTML = "Stop";

        let RAMPercentage = parseInt(document.getElementById("Rin1").value);
        const totalRAM = parseInt(document.getElementById("totalRAM").value) *  1000000000;
        const factor = ((2**29 -24) / totalRAM) * 100

        RAMworker = new Worker('js/ram_worker.js');
        RAMworker.postMessage([RAMPercentage, factor]);
    }
    else
    {
        document.getElementById('ramb').className = 'button';
        document.getElementById('ramb').innerHTML = "Start";
        
        RAMworker.terminate();
        RAMworker = "";
    }
}